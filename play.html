<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>تحدي الصمود - العب الآن</title>
    <style>
        body { margin: 0; padding: 0; overflow: hidden; background: #000; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        canvas { display: block; cursor: crosshair; }
        #overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            color: white; background: rgba(0,0,0,0.7); display: none;
        }
        .stats { position: absolute; top: 20px; right: 20px; color: #fff; font-size: 22px; text-shadow: 2px 2px 4px #000; }
        button {
            padding: 15px 40px; font-size: 20px; cursor: pointer; background: #f39c12;
            color: white; border: none; border-radius: 50px; transition: 0.3s; box-shadow: 0 5px 15px rgba(243,156,18,0.4);
        }
        button:hover { background: #e67e22; transform: scale(1.1); }
    </style>
</head>
<body>

<div class="stats">
    النقاط: <span id="currentScore">0</span> | أعلى سكور: <span id="bestScore">0</span>
</div>

<div id="overlay">
    <h1 id="statusText">انتهت اللعبة!</h1>
    <p style="font-size: 20px;">سكورك الحالي: <span id="finalScore">0</span></p>
    <button onclick="startGame()">العب مجدداً</button>
</div>

<canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const currentScoreEl = document.getElementById('currentScore');
const bestScoreEl = document.getElementById('bestScore');
const finalScoreEl = document.getElementById('finalScore');
const overlay = document.getElementById('overlay');

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let bird, pipes, frame, score, gameRunning;
let highScor = localStorage.getItem('cubeHighScore') || 0;
bestScoreEl.innerText = highScor;

function init() {
    bird = { x: 50, y: canvas.height/2, size: 25, gravity: 0.6, lift: -10, velocity: 0 };
    pipes = [];
    frame = 0;
    score = 0;
    gameRunning = true;
    overlay.style.display = 'none';
}

function drawBird() {
    ctx.fillStyle = '#00f2fe';
    ctx.shadowBlur = 15;
    ctx.shadowColor = '#00f2fe';
    ctx.fillRect(bird.x, bird.y, bird.size, bird.size);
    ctx.shadowBlur = 0;
}

function drawPipes() {
    pipes.forEach(pipe => {
        ctx.fillStyle = `hsl(${frame % 360}, 70%, 50%)`; // لون يتغير تدريجياً
        ctx.fillRect(pipe.x, 0, 60, pipe.top);
        ctx.fillRect(pipe.x, canvas.height - pipe.bottom, 60, pipe.bottom);
    });
}

function update() {
    if (!gameRunning) return;

    bird.velocity += bird.gravity;
    bird.y += bird.velocity;

    if (frame % 90 === 0) {
        let spacing = 180;
        let top = Math.random() * (canvas.height - spacing - 100) + 50;
        pipes.push({ x: canvas.width, top: top, bottom: canvas.height - top - spacing });
    }

    pipes.forEach((pipe, i) => {
        pipe.x -= 4;
        if (pipe.x + 60 < 0) {
            pipes.splice(i, 1);
            score++;
            currentScoreEl.innerText = score;
        }

        // Collision detection
        if (bird.x < pipe.x + 60 && bird.x + bird.size > pipe.x &&
            (bird.y < pipe.top || bird.y + bird.size > canvas.height - pipe.bottom)) {
            endGame();
        }
    });

    if (bird.y > canvas.height || bird.y < 0) endGame();
    frame++;
}

function loop() {
    ctx.fillStyle = '#1a1a1a';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    drawPipes();
    drawBird();
    update();
    if (gameRunning) requestAnimationFrame(loop);
}

function endGame() {
    gameRunning = false;
    if (score > highScor) {
        highScor = score;
        localStorage.setItem('cubeHighScore', highScor);
        bestScoreEl.innerText = highScor;
    }
    finalScoreEl.innerText = score;
    overlay.style.display = 'flex';
}

function startGame() {
    init();
    loop();
}

window.addEventListener('keydown', (e) => { if(e.code === 'Space') bird.velocity = bird.lift; });
window.addEventListener('touchstart', () => { bird.velocity = bird.lift; });

startGame();
</script>
</body>
</html>